<!DOCTYPE html>
<html>
<head>
  <title>Pickleball MMR</title>
  <style>
    body { font-family: sans-serif; }
    table { border-collapse: collapse; margin-bottom: 20px; }
    td, th { border: 1px solid black; padding: 5px 10px; text-align: center; }
    input, select { margin-bottom: 5px; }
  </style>
</head>
<body>
  <h1>Pickleball Club Rankings</h1>
  
  <table id="rankingTable">
    <tr><th>Player</th><th>MMR</th><th>Streak</th></tr>
  </table>

  <h2>Add a Match</h2>
  <form id="matchForm">
    Winner: <input type="text" id="winner" required><br>
    Loser: <input type="text" id="loser" required><br>
    Winner Score: <input type="number" id="winner_score" required><br>
    Loser Score: <input type="number" id="loser_score" required><br>
    Match Type:
    <select id="match_type">
      <option value="singles">Singles</option>
      <option value="doubles">Doubles</option>
    </select><br>
    <button type="submit">Submit Match</button>
  </form>

  <script>
    // Load player data from localStorage, or start with defaults
    let players = JSON.parse(localStorage.getItem('players')) || [
      {name: "CJ", elo: 800, streak: 0},
      {name: "Henry", elo: 800, streak: 0},
      {name: "Ayaan", elo: 800, streak: 0},
      {name: "Zach", elo: 800, streak: 0}
    ];

    const K_singles = 32;
    const K_doubles = 16;
    const alpha = 0.2;

    function savePlayers() {
      localStorage.setItem('players', JSON.stringify(players));
    }

    function updateTable() {
      const table = document.getElementById('rankingTable');
      table.innerHTML = "<tr><th>Player</th><th>MMR</th><th>Streak</th></tr>";
      players.sort((a,b)=>b.elo - a.elo).forEach(p=>{
        table.innerHTML += `<tr><td>${p.name}</td><td>${Math.round(p.elo)}</td><td>${p.streak}</td></tr>`;
      });
    }

    function expectedScore(RA,RB){ return 1/(1+Math.pow(10,(RB-RA)/400)); }

    function updateElo(winner,loser,winner_score,loser_score,match_type){
      let RA = winner.elo;
      let RB = loser.elo;
      let S = 1;
      let E = expectedScore(RA,RB);
      let K = match_type==='singles'?K_singles:K_doubles;
      let streak_factor = 1 + 0.05 * winner.streak;
      let score_factor = 1 + alpha * ((winner_score - loser_score)/11);
      let delta = K*(S-E)*streak_factor*score_factor;
      winner.elo += delta;
      loser.elo -= delta;
      winner.streak += 1;
      loser.streak = 0;
    }

    document.getElementById('matchForm').addEventListener('submit', function(e){
      e.preventDefault();
      let winnerName = document.getElementById('winner').value.trim();
      let loserName = document.getElementById('loser').value.trim();
      let winner_score = parseInt(document.getElementById('winner_score').value);
      let loser_score = parseInt(document.getElementById('loser_score').value);
      let match_type = document.getElementById('match_type').value;

      let winner = players.find(p=>p.name===winnerName);
      let loser = players.find(p=>p.name===loserName);
      if(!winner){ winner={name:winnerName,elo:800,streak:0}; players.push(winner); }
      if(!loser){ loser={name:loserName,elo:800,streak:0}; players.push(loser); }

      updateElo(winner,loser,winner_score,loser_score,match_type);
      savePlayers();
      updateTable();
      document.getElementById('matchForm').reset();
    });

    updateTable();
  </script>
</body>
</html>

